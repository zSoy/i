<!DOCTYPE html>
<html>
  <head>
    <title>智译</title>
    <style type="text/css">
      #container{
        width:80vw;
        display: flex;
        flex-wrap: wrap;
      }
      #operations{
        width: 100vw;
      }
      #trans{
        width: 100px;
        height: 40px;
        border-radius: 6px;
        border-width:0;
        background-color: #777;
        color: #fff;
      }
      #trans:hover{
        background-color: #666;
      }
      textarea{
        width: 50vw;
        height: 150px;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="operations">
        <button id="trans">按钮</button>
      </div>
      <div id="input">
        <textarea id="data" placeholder="请输入要翻译的文字"></textarea>
        <div id="youdao">
          <textarea id="meaning"></textarea>
          <div id="youdao_bar">
            <span id="youdao_k">英<p id="youdao_k_phonetic"></p></span>
            <span id="youdao_s">美<p id="youdao_s_phonetic"></p></span>
            <span id="exam_type"></span>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.querySelector("#trans").addEventListener("click", function(){
        async function youdao(d, f, t){
          formdata = (d, f, t) => `q=${d}&from=${f}&to=${t}`;
          try{
            let res = await fetch("https://aidemo.youdao.com/trans",{
              method: 'post',
              mode: 'cors',
              headers: {
                'accept': 'application/json, text/javascript, */*; q=0.01',
                'content-type': 'application/x-www-form-urlencoded; charset=UTF-8'
              },
             body: formdata(d, f??'en', t??'zh-CHS')
            });
            return await res.json();
          }catch(e){};
          return null;
        };
        async function jinshan(d){
          let s = new Date().getTime();
          sign = ()=>md5(`/dictionary/word/query/web61000006${s}${d}7ece94d9f9c202b0d2ec557dg4r9bc`)
          fetch('http://dict.iciba.com/dictionary/word/query/web?client=6&key=1000006&timestamp=${s}&word=${d}&signature=${}')
        }
        function clickPlay(e){
          let audio = new Audio(e.src);
          audio.play();
        }
        let data = document.querySelector("#data").value;
        data = youdao(data);
        if(data){
          let exam_type = data?.basic?.exam_type.join();
          let explains = data?.basic?.explains.join('\n');
          try{
            console.log(data["basic"]["uk_phonetic"]);
            console.log(data["basic"]["uk-phonetic"]);
            let uk_phonetic = '['+ data?.basic["uk-phonetic"] + ']';
            document.querySelector("#youdao_k_phonetic").innerText = uk_phonetic;
          }catch(e){console.log(e);};
          try{
            let us_phonetic = '['.concat(data["basic"]["us-phonetic"], ']');
            document.querySelector("#youdao_s_phonetic").innerText = us_phonetic;
          }catch(e){console.log(e)}
          try{
            document.querySelector("#youdao_k").src=data["basic"]["uk-speech"];
          }catch(e){console.log(e)}
          try{
            document.querySelector("#youdao_s").src=data["basic"]["us-speech"];
            
          let usecase = data["web"].slice(1).map(x=>x["key"].concat('\t',x["value"])).join('\n');
            console.log(usecase);
          }catch(e){console.log(e)}
          document.querySelector("#youdao_k").addEventListener("click", clickPlay);
          document.querySelector("#youdao_s").addEventListener("click", clickPlay);
          document.querySelector("#exam_type").innerText = exam_type;
          document.querySelector("#meaning").value=explains.concat('\n\n');
        }
      });
    </script>
  </body>
</html>
